# ADR-009: 모노레포 설정 표준화 및 패키지 구조 정립

## 상태
승인됨 (2025-09-21)

## 컨텍스트

미니 노션 프로젝트는 Turbo 기반 모노레포로 구성되어 있으며, 여러 앱과 패키지 간의 설정 일관성과 의존성 관리가 중요한 이슈가 되었습니다.

### 현재 상황
- 프론트엔드(React), 백엔드(NestJS), 공통 패키지들이 각각 다른 설정 사용
- ESLint, TypeScript, Prettier 등의 설정이 앱별로 중복 정의
- 의존성 버전 불일치로 인한 호환성 문제 발생
- 새로운 패키지 추가 시 설정 복사/붙여넣기로 인한 비일관성
- 공통 타입 정의가 분산되어 타입 안전성 저하

### 해결해야 할 문제
1. **설정 중복 및 불일치**: 각 앱마다 유사한 설정을 반복 정의
2. **의존성 관리 복잡성**: 버전 불일치, 중복 설치, 호이스팅 문제
3. **타입 안전성 부족**: 공통 타입이 분산되어 일관성 부족
4. **확장성 제한**: 새로운 앱/패키지 추가 시 설정 작업 부담
5. **유지보수 어려움**: 설정 변경 시 여러 파일 수정 필요

### 제약사항 및 요구사항
- Turbo 모노레포 구조 유지
- 기존 앱들의 기능 영향 최소화
- TypeScript strict 모드 및 JSDoc 표준 준수
- 최신 버전 우선 정책 유지
- 개발자 경험(DX) 향상

## 결정

**중앙화된 설정 패키지와 표준화된 의존성 관리 체계를 구축한다.**

핵심 결정사항:
1. `packages/config` 패키지로 모든 공통 설정 중앙화
2. 계층적 설정 구조 (base → environment → app) 적용
3. 루트 레벨 공통 도구 설치 및 workspace 프로토콜 활용
4. `packages/shared` 패키지로 공통 타입 및 유틸리티 통합
5. JSDoc 표준과 연동된 설정 자동화

## 고려된 옵션들

### 옵션 1: 각 앱별 독립 설정 유지
**장점:**
- 앱별 특화 설정 자유도 높음
- 기존 구조 변경 최소화
- 앱 간 설정 충돌 없음

**단점:**
- 설정 중복으로 유지보수 부담 증가
- 일관성 보장 어려움
- 새 앱 추가 시 설정 작업 반복
- 공통 규칙 변경 시 여러 파일 수정 필요

### 옵션 2: 단일 설정 파일로 통합
**장점:**
- 설정 관리 단순화
- 일관성 보장 용이
- 변경 사항 한 곳에서 관리

**단점:**
- 앱별 특화 설정 어려움
- 설정 파일 크기 증가
- 환경별 분기 로직 복잡화
- 확장성 제한

### 옵션 3: 계층적 설정 패키지 (선택됨)
**장점:**
- 공통 설정 중앙화 + 앱별 커스터마이징 가능
- 명시적 상속 구조로 이해하기 쉬움
- 확장성과 유지보수성 균형
- 점진적 적용 가능

**단점:**
- 초기 설정 복잡도 증가
- 설정 상속 구조 학습 필요
- packages/config 패키지 의존성 증가

## 결정 근거

### 1. 기술적 근거
- **중앙화된 관리**: 설정 변경 시 한 곳에서만 수정하면 전체 적용
- **타입 안전성**: TypeScript + JSDoc 연동으로 설정 오류 사전 방지
- **자동화 가능**: ESLint, Prettier 등 도구 체인 자동 적용
- **확장성**: 새로운 환경(Electron, Mobile 등) 쉽게 추가 가능

### 2. 비즈니스 근거
- **개발 효율성**: 새 앱/패키지 추가 시간 70% 단축 예상
- **품질 향상**: 일관된 설정으로 코드 품질 표준화
- **유지보수 비용**: 설정 관리 비용 60% 절감 예상
- **온보딩 시간**: 새로운 개발자 설정 이해 시간 단축

### 3. 팀 역량 고려사항
- **학습 곡선**: 기존 ESLint, TypeScript 지식 활용 가능
- **점진적 적용**: 기존 앱에 단계적으로 적용 가능
- **문서화**: 설정 패턴과 사용법 명확히 문서화

### 4. 장기적 관점
- **확장성**: 프로젝트 성장에 따른 설정 복잡도 관리
- **표준화**: 업계 모범 사례 준수 및 적용
- **호환성**: 새로운 도구 도입 시 기존 구조와 호환

## 구현 계획

### Phase 1: 기반 구축 (1주)
- [ ] `packages/config` 패키지 생성
- [ ] 기본 TypeScript, ESLint, Prettier 설정 작성
- [ ] JSDoc 규칙 통합
- [ ] 루트 package.json 의존성 정리

### Phase 2: 공통 타입 정립 (1주)
- [ ] `packages/shared` 구조 정리
- [ ] 도메인별 타입 정의 (User, Document, Collaboration 등)
- [ ] JSDoc 문서화 적용
- [ ] Zod 스키마와 타입 연동

### Phase 3: 앱별 적용 (2주)
- [ ] `apps/web` 설정 마이그레이션
- [ ] `apps/api` 설정 마이그레이션
- [ ] 기존 기능 동작 검증
- [ ] 빌드/테스트 파이프라인 검증

### Phase 4: 최적화 및 문서화 (1주)
- [ ] 의존성 중복 제거 및 최적화
- [ ] 설정 가이드 문서 작성
- [ ] 팀 교육 및 피드백 수집
- [ ] 모니터링 및 개선

## 결과 및 영향

### 긍정적 결과
1. **개발 생산성 향상**
   - 새 앱/패키지 생성 시간 70% 단축
   - 설정 관련 이슈 해결 시간 80% 감소

2. **코드 품질 개선**
   - 일관된 린팅 규칙으로 코드 품질 표준화
   - JSDoc 표준 적용으로 문서화 품질 향상

3. **유지보수성 향상**
   - 설정 변경 시 영향 범위 명확화
   - 중앙화된 관리로 변경 추적 용이

4. **타입 안전성 강화**
   - 공통 타입 패키지로 일관성 보장
   - 런타임 검증과 타입 시스템 연동

### 부정적 결과 및 위험
1. **초기 복잡도 증가**
   - 설정 상속 구조 이해 필요
   - 마이그레이션 작업 부담

2. **의존성 관리 복잡성**
   - packages/config 패키지 의존성 증가
   - 버전 호환성 관리 필요

3. **설정 충돌 위험**
   - 앱별 특화 설정과 공통 설정 간 충돌 가능
   - 환경별 설정 분기 복잡화

### 완화 방안
1. **점진적 마이그레이션**
   - 새 앱부터 적용 시작
   - 기존 앱은 안정성 확보 후 단계적 적용

2. **명확한 문서화**
   - 설정 상속 구조 다이어그램 제공
   - 사용 예시와 트러블슈팅 가이드 작성

3. **자동화 강화**
   - 설정 검증 스크립트 제공
   - CI/CD에서 설정 일관성 자동 검사

4. **팀 교육**
   - 설정 패턴 워크샵 진행
   - 정기적인 Q&A 세션 운영

## 측정 지표

### 개발 효율성
- 새 앱/패키지 생성 시간 (목표: 70% 단축)
- 설정 관련 이슈 해결 시간 (목표: 80% 감소)
- 코드 리뷰에서 설정 관련 지적 빈도 (목표: 90% 감소)

### 코드 품질
- ESLint 규칙 위반 건수 (목표: 50% 감소)
- JSDoc 커버리지 (목표: 80% 이상)
- TypeScript 컴파일 에러 빈도 (목표: 30% 감소)

### 유지보수성
- 설정 변경 시 수정 파일 수 (목표: 90% 감소)
- 의존성 버전 불일치 건수 (목표: 95% 감소)
- 빌드 실패율 (목표: 50% 감소)

## 관련 결정
- **ADR-004**: Turbo 모노레포 구조 (기반 아키텍처)
- **ADR-008**: JSDoc 문서화 표준 (설정과 연동)
- **ADR-002**: React 19 + Vite (프론트엔드 설정 기반)
- **ADR-001**: NestJS 백엔드 (백엔드 설정 기반)

## 참고 자료
- [Turbo 모노레포 설정 가이드](https://turbo.build/repo/docs/handbook/sharing-code/internal-packages)
- [ESLint Shareable Configs](https://eslint.org/docs/latest/extend/shareable-configs)
- [TypeScript Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
- [pnpm Workspace](https://pnpm.io/workspaces)
- [Zod TypeScript-first schema validation](https://zod.dev/)