---
inclusion: manual
---

# Docker 컨테이너 및 배포 표준

미니 노션 프로젝트의 컨테이너화 및 배포를 위한 포괄적인 가이드라인입니다. 멀티스테이지 빌드, 환경 관리, CI/CD 파이프라인, 프로덕션 배포까지 전체 DevOps 워크플로우의 표준을 정의합니다.

## 멀티스테이지 Docker 빌드 패턴

### 빌드 최적화 전략

**스테이지 분리 원칙**
- 의존성 설치, 빌드, 런타임 스테이지 명확히 구분
- 각 스테이지별 최적화된 베이스 이미지 선택
- 불필요한 파일 및 의존성 제거로 이미지 크기 최소화
- 캐시 효율성을 위한 레이어 순서 최적화

**Node.js 애플리케이션 빌드 패턴**
- Alpine Linux 기반 경량 이미지 사용
- pnpm을 활용한 효율적인 의존성 관리
- 프로덕션 의존성과 개발 의존성 분리
- 소스 코드 변경 시에만 재빌드되도록 레이어 구성

**보안 강화 빌드**
- 비특권 사용자로 애플리케이션 실행
- 불필요한 패키지 및 도구 제거
- 보안 업데이트 자동 적용
- 이미지 취약점 스캔 통합

### 빌드 성능 최적화

**캐시 전략**
- 의존성 설치 레이어의 캐시 최대 활용
- .dockerignore를 통한 불필요한 파일 제외
- 빌드 컨텍스트 크기 최소화
- 멀티플랫폼 빌드 시 캐시 공유

**병렬 빌드**
- 독립적인 서비스의 병렬 빌드
- BuildKit을 활용한 고급 빌드 기능
- 빌드 시간 단축을 위한 최적화 기법
- 빌드 메트릭 수집 및 분석

**이미지 최적화**
- 멀티스테이지 빌드로 최종 이미지 크기 최소화
- 레이어 압축 및 최적화
- 베이스 이미지 정기 업데이트
- 이미지 태깅 및 버전 관리 전략

## Docker Compose 서비스 구성

### 서비스 아키텍처

**서비스 분리 원칙**
- 프론트엔드, 백엔드, 데이터베이스 서비스 독립 구성
- 각 서비스별 전용 네트워크 구성
- 서비스 간 의존성 명확히 정의
- 헬스체크를 통한 서비스 상태 모니터링

**개발 환경 구성**
- 핫 리로드를 위한 볼륨 마운트 설정
- 개발용 환경변수 및 설정 분리
- 디버깅을 위한 포트 노출 관리
- 로그 수집 및 모니터링 설정

**네트워크 및 보안**
- 서비스별 격리된 네트워크 구성
- 외부 노출 포트 최소화
- 내부 통신을 위한 서비스 디스커버리
- 시크릿 관리 및 환경변수 보안

### 리소스 관리

**리소스 제한**
- CPU 및 메모리 제한 설정
- 디스크 I/O 제한 및 모니터링
- 네트워크 대역폭 관리
- 리소스 사용량 모니터링 및 알림

**스케일링 전략**
- 수평 확장 가능한 서비스 설계
- 로드 밸런싱 및 트래픽 분산
- 상태 비저장 서비스 구성
- 데이터베이스 연결 풀 관리

**데이터 영속성**
- 데이터베이스 볼륨 관리
- 백업 및 복원 전략
- 데이터 마이그레이션 지원
- 개발/프로덕션 데이터 분리

## 환경변수 관리 및 Zod 검증

### 환경변수 구조화

**계층적 환경 관리**
- 기본값, 개발, 스테이징, 프로덕션 환경 분리
- 환경별 오버라이드 규칙 정의
- 민감한 정보와 일반 설정 구분
- 환경변수 네이밍 컨벤션 표준화

**보안 고려사항**
- 민감한 환경변수의 암호화 저장
- 시크릿 관리 시스템 통합
- 환경변수 접근 권한 제어
- 로그에서 민감 정보 마스킹

**설정 검증**
- Zod 스키마를 통한 런타임 검증
- 필수 환경변수 누락 시 애플리케이션 시작 중단
- 타입 안전성 보장 및 자동 완성 지원
- 설정 변경 시 검증 및 재시작 로직

### 환경별 설정 관리

**개발 환경**
- 로컬 개발을 위한 기본값 제공
- 개발자별 커스터마이징 지원
- 디버깅 및 로깅 레벨 설정
- 개발 도구 통합 설정

**테스트 환경**
- 테스트 전용 데이터베이스 설정
- 테스트 실행 시 격리된 환경 보장
- 모킹 및 스텁 설정 관리
- 테스트 데이터 초기화 설정

**프로덕션 환경**
- 고가용성을 위한 설정 최적화
- 성능 모니터링 및 메트릭 수집
- 보안 강화 설정 적용
- 장애 복구를 위한 설정 관리

## GitHub Actions CI/CD 파이프라인

### 파이프라인 아키텍처

**워크플로우 구조**
- 코드 품질 검사, 테스트, 빌드, 배포 단계 분리
- 병렬 실행 가능한 작업 최적화
- 조건부 실행을 통한 효율성 향상
- 실패 시 빠른 피드백 제공

**브랜치 전략 통합**
- main 브랜치 자동 배포
- PR 생성 시 자동 테스트 실행
- 피처 브랜치별 미리보기 환경 생성
- 태그 기반 릴리스 자동화

**보안 및 권한 관리**
- 시크릿 관리 및 접근 제어
- 배포 승인 워크플로우
- 감사 로그 및 추적 가능성
- 취약점 스캔 자동화

### 테스트 자동화

**테스트 단계별 실행**
- 단위 테스트 우선 실행으로 빠른 피드백
- 통합 테스트 병렬 실행
- E2E 테스트 선택적 실행
- 테스트 결과 리포팅 및 알림

**테스트 환경 관리**
- 각 테스트 단계별 독립적인 환경
- 테스트 데이터 초기화 및 정리
- 테스트 실행 시간 최적화
- 테스트 실패 시 디버깅 정보 수집

**코드 품질 관리**
- ESLint, Prettier 자동 실행
- 코드 커버리지 측정 및 리포팅
- 보안 취약점 스캔
- 의존성 업데이트 자동화

### 배포 자동화

**배포 전략**
- 블루-그린 배포 또는 롤링 업데이트
- 카나리 배포를 통한 점진적 롤아웃
- 자동 롤백 메커니즘
- 배포 상태 모니터링 및 알림

**환경별 배포**
- 스테이징 환경 자동 배포
- 프로덕션 배포 승인 프로세스
- 환경별 설정 및 시크릿 관리
- 배포 후 검증 및 헬스체크

**모니터링 및 알림**
- 배포 성공/실패 알림
- 성능 메트릭 수집
- 에러 추적 및 로그 수집
- 사용자 영향도 모니터링

## TestContainers 통합 전략

### 테스트 환경 구성

**컨테이너 기반 테스트**
- 실제 데이터베이스 및 서비스 컨테이너 사용
- 테스트별 격리된 환경 보장
- 테스트 완료 후 자동 정리
- 병렬 테스트 실행 지원

**서비스 의존성 관리**
- 필요한 서비스만 선택적 시작
- 서비스 간 의존성 순서 관리
- 헬스체크를 통한 서비스 준비 상태 확인
- 네트워크 격리 및 포트 관리

**데이터 관���**
- 테스트 데이터 초기화 스크립트
- 테스트 간 데이터 격리
- 스냅샷 기반 빠른 데이터 복원
- 대용량 테스트 데이터 효율적 관리

### 성능 최적화

**컨테이너 재사용**
- 동일한 설정의 컨테이너 재사용
- 컨테이너 시작 시간 최적화
- 리소스 사용량 모니터링
- 컨테이너 풀링 전략

**테스트 실행 최적화**
- 테스트 분류 및 우선순위 설정
- 빠른 테스트 우선 실행
- 느린 테스트 병렬 실행
- 테스트 실행 시간 추적

**CI/CD 통합**
- GitHub Actions에서 TestContainers 실행
- 테스트 결과 캐싱
- 테스트 아티팩트 보관
- 테스트 메트릭 수집 및 분석

## 프로덕션 배포 체크리스트

### 배포 전 검증

**코드 품질 검증**
- [ ] 모든 테스트 통과 확인
- [ ] 코드 리뷰 완료 및 승인
- [ ] 보안 취약점 스캔 통과
- [ ] 성능 테스트 결과 검토
- [ ] 의존성 업데이트 및 취약점 확인

**인프라 준비**
- [ ] 프로덕션 환경 리소스 확인
- [ ] 데이터베이스 마이그레이션 준비
- [ ] 백업 및 복원 절차 확인
- [ ] 모니터링 및 알림 설정 검증
- [ ] 로드 밸런서 및 CDN 설정 확인

**설정 및 환경변수**
- [ ] 프로덕션 환경변수 검증
- [ ] 시크릿 및 인증서 업데이트
- [ ] 외부 서비스 연동 테스트
- [ ] 로그 레벨 및 수집 설정 확인
- [ ] 캐시 및 세션 설정 검증

### 배포 실행

**배포 절차**
- [ ] 배포 시작 전 팀 알림
- [ ] 트래픽 모니터링 시작
- [ ] 단계적 배포 실행
- [ ] 각 단계별 헬스체크 확인
- [ ] 사용자 영향도 모니터링

**검증 및 테스트**
- [ ] 핵심 기능 동작 확인
- [ ] API 엔드포인트 응답 테스트
- [ ] 데이터베이스 연결 및 쿼리 테스트
- [ ] 실시간 협업 기능 테스트
- [ ] 성능 메트릭 정상 범위 확인

**모니터링 및 대응**
- [ ] 에러율 및 응답시간 모니터링
- [ ] 리소스 사용률 확인
- [ ] 로그 에러 패턴 분석
- [ ] 사용자 피드백 모니터링
- [ ] 알림 및 대시보드 정상 동작 확인

### 배포 후 관리

**안정성 확인**
- [ ] 24시간 안정성 모니터링
- [ ] 성능 지표 기준선 대비 확인
- [ ] 사용자 행동 패턴 분석
- [ ] 에러 로그 및 예외 상황 검토
- [ ] 백업 및 복구 절차 테스트

**문서화 및 공유**
- [ ] 배포 노트 작성 및 공유
- [ ] 변경사항 사용자 가이드 업데이트
- [ ] 팀 내 배포 결과 공유
- [ ] 개선사항 및 교훈 정리
- [ ] 다음 배포를 위한 액션 아이템 정의

**롤백 준비**
- [ ] 롤백 절차 문서화
- [ ] 롤백 트리거 조건 정의
- [ ] 자동 롤백 메커니즘 테스트
- [ ] 데이터 일관성 보장 방안 확인
- [ ] 롤백 후 복구 절차 준비

## 보안 및 컴플라이언스

### 컨테이너 보안

**이미지 보안**
- 베이스 이미지 정기 업데이트
- 취약점 스캔 자동화
- 서명된 이미지만 사용
- 최소 권한 원칙 적용

**런타임 보안**
- 비특권 사용자로 실행
- 읽기 전용 파일시스템 사용
- 네트워크 정책 적용
- 리소스 제한 설정

**시크릿 관리**
- 환경변수에 민감 정보 저장 금지
- 시크릿 관리 시스템 사용
- 정기적인 시크릿 순환
- 접근 권한 최소화

### 모니터링 및 감사

**로그 관리**
- 중앙화된 로그 수집
- 로그 보존 정책 적용
- 민감 정보 마스킹
- 로그 무결성 보장

**메트릭 수집**
- 애플리케이션 성능 메트릭
- 인프라 리소스 메트릭
- 보안 이벤트 추적
- 사용자 행동 분석

**알림 및 대응**
- 임계치 기반 자동 알림
- 에스컬레이션 정책 정의
- 인시던트 대응 절차
- 복구 시간 목표 설정

이 표준을 따라 구현하면 안정적이고 확장 가능한 컨테이너 기반 배포 시스템을 구축할 수 있습니다. 각 단계별 체크리스트와 가이드라인을 통해 일관된 품질의 배포를 보장하고, 장애 발생 시 빠른 대응이 가능합니다.